# vim: set et sts=2 sw=2:
# encoding: utf-8

schema:
  schema_id: uggx
  name: 郑码
  version: '1.0'
  author:
    - X1aomu
  description: |
    郑码，又称「字根通用码」，是由中国文字学家、《英华大词典》主编郑易里经过对汉字的研究所发想，后经其女儿郑珑所完成的一种字形输入法。

    什么？这个方案为什么叫 uggx？那是因为「郑码」的郑码就是「uggx」。

    本方案特点：

      + 不自动上屏
      + 4 码顶字上屏
      + 足 4 码无候选时下一码自动清动清除前 4 码
      + 出字优先级（从高到低）： 预设单字、用户词组、预设词组，其中用户词组为动态词频，其余为固定词频
      + 自动根据上屏历史造词
      + 使用分词符 "'" 可自造词
      + "`" 开头进入拼音反查模式
      + aa 开头可打出符号，详见 uggx.symbols.dict.yaml
      + 回车清屏
      + 分号选择第二候选词

  dependencies:
    - pinyin_simp # 反查所需依赖
    - uggx.phrases # 为了使用预置的短语字典，还要控制其出字优先级，目前只能加上这方案的依赖

switches:
  - name: ascii_mode
    states: [ 中文, 西文 ]
  - name: full_shape
    states: [ 半角, 全角 ]
  # - name: simplification
  #   states: [ 漢字, 汉字 ]
  - name: extended_charset
    states: [ 常用, 增廣 ]
  - name: ascii_punct
    states: [ 。，, ．， ]

engine:
  processors:
    - ascii_composer
    - recognizer
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - affix_segmentor@make_dict
    - affix_segmentor@pinyin_simp
    - punct_segmentor
    - fallback_segmentor
  translators:
    # - echo_translator #没有其他候选字时，回显输入码〔输入码可以Shift+Enter上屛〕
    - punct_translator
    - table_translator
    - table_translator@user_dict_translator
    - table_translator@phrase_translator
    - table_translator@make_dict
    # - reverse_lookup_translator # 反查。弃用，用 filters/reverse_lookup_filter 替代
    - script_translator@pinyin_simp
  filters:
    # - simplifier # 用字转换
    - charset_filter # 字符集过滤
    - uniquifier # 去重
    # - cjk_minifier # 用于 script_translater，搭配 extended_charset 使用
    - reverse_lookup_filter@pinyin_simp_reverse_lookup
    # - single_char_filter # 单字过滤器，屏蔽词组

# simplifier:
#   tips: all
#   tags: [ abc ]

charset_filter:
  tags: [ abc ]

recognizer:
  __include: default:/recognizer
  patterns:
    punct: '^/([a-z]*|[0-9]|10)$'
    make_dict: "^.*'.*$" # 含 "'" 时启用手动造词
    pinyin_simp: "^`[a-z']*$" # 反查引導鍵 以 ` 开头

key_binder:
  __include: default:/key_binder
  __append:
    # 回车清屏
    - { when: composing, accept: Return, send: Escape }
    # 设置分号为选择第二候选
    - { when: has_menu, accept: semicolon, send: 2 }

speller:
  delimiter: "'"
  max_code_length: 4 # 设置最大码长 开启此选项可以实现顶字上屏
  auto_select: false # 是否自动上屏
  auto_clear: max_length # 输入全码长无候选时自动清空

punctuator:
  __include: symbols:/punctuator

# 默认的单字翻译器，这个只给出单字，优先级最高
translator:
  initial_quality: 1000000 # 调整编译器出字的优先度
  dictionary: uggx # 词库的设置请看 uggx.dict.yaml
  db_class: userdb # 设定用户词典类型，可设 tabledb〔文本〕或 userdb〔二进制〕
  enable_charset_filter: true # 开启字符集过滤
  enable_user_dict: false # 是否開啓用戶詞典〔用戶詞典記錄動態字詞頻、用戶詞〕
  enable_encoder: false # 是否自造词
  encode_commit_history: false # 是否對已上屛詞自動成詞
  enable_sentence: false # 连打
  enable_completion: true # 逐键提示

# 用户词典翻译器，这个会给出用户词典（来自上屏历史记录与手动造词）里的词语，优先级介于单字和预置词组之间
user_dict_translator:
  __include: translator
  initial_quality: 10000
  enable_user_dict: true
  enable_encoder: true
  encode_commit_history: true # 如果不需要使用上屏历史自动成词，设为 false
  max_phrase_length: 10 # 自造词长度。文档说这是针对 preset_vocabulary 的，不过实测对用户自造词的选用亦有影响

# 预置词组翻译器，这个只给出词组，优先级最低
phrase_translator:
  __include: translator
  initial_quality: 100
  dictionary: uggx.phrases

# 手动造词翻译器，当输入含有 "'" 时生效
make_dict:
  __include: user_dict_translator
  initial_quality: 10
  enable_sentence: true
  tips: '〔自造词〕'
  tag: make_dict

# 反查翻译器，以 ` 开头时生效
pinyin_simp:
  __include: pinyin_simp.schema:/translator
  prefix: '`'
  tips: '〔拼音〕'
  tag: pinyin_simp # 必要

# 反查过滤器，给出反查编码提示
pinyin_simp_reverse_lookup:
  tags: [ pinyin_simp ] # 掛在這個 tag 所對應的翻譯器上
  overwrite_comment: false
  dictionary: uggx # 反查所用字典
  comment_format:
    - 'xform/$/〕/'
    - 'xform/^/〔/'

